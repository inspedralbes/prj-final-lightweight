# src/front/Dockerfile.prod (PRODUCTION)

# ── Stage 1: build ──────────────────────────────────────────
FROM node:22-alpine AS build

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

# Vite embeds VITE_* env vars at build time, so we pass it as ARG
ARG VITE_BACK_URL=/api
ENV VITE_BACK_URL=$VITE_BACK_URL

RUN npm run build

# ── Stage 2: serve static files ─────────────────────────────
FROM node:22-alpine

WORKDIR /app
RUN npm install -g serve@latest

COPY --from=build /app/dist ./dist

EXPOSE 5173

# serve -s = SPA mode (returns index.html for unknown routes)
CMD ["serve", "-s", "dist", "-l", "5173"]
